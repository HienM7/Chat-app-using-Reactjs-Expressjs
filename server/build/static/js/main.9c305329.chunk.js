(this["webpackJsonpreact-client-real-time-app-chat"]=this["webpackJsonpreact-client-real-time-app-chat"]||[]).push([[0],{129:function(e,t,a){e.exports=a(233)},134:function(e,t,a){},135:function(e,t,a){},182:function(e,t){},233:function(e,t,a){"use strict";a.r(t);var n,r=a(0),o=a.n(r),c=a(11),i=a.n(c),s=(a(134),a(135),a(7)),l=a(272),u=a(63),m=a(235),p=a(281),d=a(282),b=a(278),f=a(270),g=a(267),v=a(15),h=a.n(v),E=a(20),x=a(279),O=a(16),y=a.n(O),j=a(57),w=a(117),k=a(33),C=a(112),N=a.n(C),S=o.a.createContext(),I={},R=function(e,t){var a=t.payload,n=a.roomId,r=a.fromUser,o=a.msg;switch(t.type){case"RECEIVE_MESSAGE":return Object(k.a)(Object(k.a)({},e),{},Object(j.a)({},n,Object(k.a)(Object(k.a)({},e[n]),{},{messages:[].concat(Object(w.a)(e[n].messages),[{user:r,content:o}])})));case"JOIN_NEW_ROOM":return Object(k.a)(Object(k.a)({},e),t.payload);case"RECEIVE_DATA_FROM_SERVER":return t.payload;default:throw new Error("Type of action no exist")}};function B(e){n.emit("chat message",e)}var L=function(e){var t=e.children,a=Object(r.useReducer)(R,I),c=Object(s.a)(a,2),i=c[0],l=c[1],u=Object(r.useState)(!0),m=Object(s.a)(u,2),p=m[0],d=m[1];return Object(r.useEffect)((function(){(function(){var e=Object(E.a)(h.a.mark((function e(){var t,a;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,y.a.get("/data/getMessage");case 3:if(t=e.sent,(a=t.data).success){e.next=7;break}return e.abrupt("return");case 7:l({type:"RECEIVE_DATA_FROM_SERVER",payload:a.allMessage}),d(!1),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(0),console.log(e.t0);case 14:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(){return e.apply(this,arguments)}})()(),(n=N()("/")).on("chat message",(function(e){l({type:"RECEIVE_MESSAGE",payload:e})}))}),[]),p?o.a.createElement("h3",null,"Loading..."):o.a.createElement(S.Provider,{value:{allChats:i,sendChatAction:B,dispatch:l}},t)},_=Object(g.a)((function(e){return{form:{position:"absolute",top:"30%",left:"45%",width:"300px",height:"250px",backgroundColor:"#FFF",borderRadius:"4px",padding:"30px"},container:{position:"fixed",top:0,left:0,width:"100%",height:"100%",zIndex:100,backgroundColor:"#000000a6"},textField:{width:"100%",marginBottom:"40px"},button:{margin:"2px"}}}));var P=function(e){var t=Object(r.useState)(""),a=Object(s.a)(t,2),n=a[0],c=a[1],i=Object(r.useState)(!1),l=Object(s.a)(i,2),u=l[0],m=l[1],p=Object(r.useState)(!1),d=Object(s.a)(p,2),g=d[0],v=d[1],O=Object(r.useState)(!1),j=Object(s.a)(O,2),w=j[0],k=j[1],C=_(),N=Object(r.useContext)(S).dispatch,I=function(){var e=Object(E.a)(h.a.mark((function e(t){var a,r;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),e.prev=1,m(!0),e.next=5,y.a.post("/room/join",{roomId:n});case 5:if(a=e.sent,(r=a.data).success){e.next=11;break}return v(!0),m(!1),e.abrupt("return");case 11:delete r.success,N({type:"JOIN_NEW_ROOM",payload:r}),c(""),k(!1),m(!1),e.next=23;break;case 18:e.prev=18,e.t0=e.catch(1),v(!0),m(!1),console.log(e.t0);case 23:case"end":return e.stop()}}),e,null,[[1,18]])})));return function(t){return e.apply(this,arguments)}}();return o.a.createElement("div",null,o.a.createElement(f.a,{variant:"outlined",color:"primary",onClick:function(){k(!0)}},"Join room"),w&&o.a.createElement("div",{className:C.container},o.a.createElement("form",{onSubmit:I,className:C.form},o.a.createElement("h3",null,"Join Room"),g?o.a.createElement(x.a,{severity:"error"},"Can't join room"):o.a.createElement("div",{style:{width:"100%",height:"20px"}}),o.a.createElement(b.a,{label:"Type Room ID",value:n,onChange:function(e){return c(e.target.value)},className:C.textField}),o.a.createElement(f.a,{type:"submit",variant:"outlined",color:"primary",size:"small",className:C.button,disabled:u},"Submit"),o.a.createElement(f.a,{type:"button",variant:"outlined",color:"primary",size:"small",onClick:function(){k(!1),c(""),v(!1)},className:C.button},"Close"))))},T=Object(g.a)((function(e){return{form:{position:"absolute",top:"30%",left:"45%",width:"300px",height:"250px",backgroundColor:"#FFF",borderRadius:"4px",padding:"30px"},container:{position:"fixed",top:0,left:0,width:"100%",height:"100%",zIndex:100,backgroundColor:"#000000a6"},textField:{width:"100%",marginBottom:"40px"},button:{margin:"2px"}}}));var U=function(e){var t=Object(r.useState)(""),a=Object(s.a)(t,2),n=a[0],c=a[1],i=Object(r.useState)(!1),l=Object(s.a)(i,2),u=l[0],m=l[1],p=Object(r.useState)(!1),d=Object(s.a)(p,2),g=d[0],v=d[1],O=Object(r.useState)(!1),j=Object(s.a)(O,2),w=j[0],k=j[1],C=T(),N=Object(r.useContext)(S).dispatch,I=function(){var e=Object(E.a)(h.a.mark((function e(t){var a,r;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),e.prev=1,m(!0),e.next=5,y.a.post("/room/create",{roomName:n});case 5:if(a=e.sent,(r=a.data).success){e.next=11;break}return v(!0),m(!1),e.abrupt("return");case 11:delete r.success,N({type:"JOIN_NEW_ROOM",payload:r}),c(""),k(!1),m(!1),e.next=23;break;case 18:e.prev=18,e.t0=e.catch(1),v(!0),m(!1),console.log(e.t0);case 23:case"end":return e.stop()}}),e,null,[[1,18]])})));return function(t){return e.apply(this,arguments)}}();return o.a.createElement("div",null,o.a.createElement(f.a,{variant:"outlined",color:"primary",onClick:function(){k(!0)}},"Create new room"),w&&o.a.createElement("div",{className:C.container},o.a.createElement("form",{onSubmit:I,className:C.form},o.a.createElement("h3",null,"Create New Room"),g?o.a.createElement(x.a,{severity:"error"},"Can't create room"):o.a.createElement("div",{style:{width:"100%",height:"20px"}}),o.a.createElement(b.a,{label:"Type Room Name",value:n,onChange:function(e){return c(e.target.value)},className:C.textField}),o.a.createElement(f.a,{type:"submit",variant:"outlined",color:"primary",size:"small",className:C.button,disabled:u},"Submit"),o.a.createElement(f.a,{type:"button",variant:"outlined",color:"primary",size:"small",onClick:function(){k(!1),c(""),v(!1)},className:C.button},"Close"))))},D=a(118),A=a(236),F=a(274),W=Object(g.a)((function(e){return{active:{color:"#fff",backgroundColor:"#1976d2",transition:"0.5s","&:hover":{color:"#fff",backgroundColor:"#1976d2",opacity:"0.8"}}}}));var M=function(e){var t=W(),a=Object(r.useState)(!1),n=Object(s.a)(a,2),c=n[0],i=n[1],l=e.primary,u=e.roomId,m=e.currentRoom,p=Object(D.a)(e,["primary","roomId","currentRoom"]);return Object(r.useEffect)((function(){i(u===m)}),[l,m,u]),console.log("RoomItem"),o.a.createElement(A.a,Object.assign({},p,{className:c?t.active:"",button:!0}),o.a.createElement(F.a,{primary:l}))},z=a(276),G=a(280),J=a(275),V=a(277),H=a(273);function $(e){var t=o.a.useState(!1),a=Object(s.a)(t,2),n=a[0],r=a[1],c=o.a.useRef(null),i=e.children,u=function(e){c.current&&c.current.contains(e.target)||r(!1)},m=o.a.useRef(n);o.a.useEffect((function(){!0===m.current&&!1===n&&c.current.focus(),m.current=n}),[n]);var p=function(){y.a.defaults.headers.common["x-access-token"]="",localStorage.removeItem("token"),window.location.href="/"};return o.a.createElement("div",null,o.a.createElement(f.a,{ref:c,"aria-controls":n?"menu-list-grow":void 0,"aria-haspopup":"true",onClick:function(){r((function(e){return!e}))}},i),o.a.createElement(J.a,{open:n,anchorEl:c.current,role:void 0,transition:!0,disablePortal:!0},(function(e){var t=e.TransitionProps,a=e.placement;return o.a.createElement(G.a,Object.assign({},t,{style:{transformOrigin:"bottom"===a?"center top":"center bottom"}}),o.a.createElement(l.a,null,o.a.createElement(z.a,{onClickAway:u},o.a.createElement(H.a,{autoFocusItem:n,id:"menu-list-grow"},o.a.createElement(V.a,{onClick:p},"Logout")))))})))}var q=a(76),K=a.n(q),Q=o.a.createContext(),X={isLoggedIn:!1},Y=function(e,t){var a=t.payload,n=a.username,r=a.userId,o=a.avatarUrl,c=a.isConfirmation;switch(t.type){case"USER_LOGIN":return{isLoggedIn:!0,username:n,userId:r,avatarUrl:o,isConfirmation:c};case"USER_LOGOUT":return{isLoggedIn:!1,username:"",userId:"",avatarUrl:""};default:throw new Error("Type of action no exist")}};var Z=function(e){var t=e.children,a=Object(r.useReducer)(Y,X),n=Object(s.a)(a,2),c=n[0],i=n[1],l=Object(r.useState)(!0),u=Object(s.a)(l,2),m=u[0],p=u[1];return Object(r.useEffect)((function(){(function(){var e=Object(E.a)(h.a.mark((function e(){var t,a,n;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,y.a.post("/auth/checkLogin",{token:localStorage.getItem("token")});case 3:if(t=e.sent,(a=t.data).success){e.next=8;break}return p(!1),e.abrupt("return");case 8:y.a.defaults.headers.common["x-access-token"]=localStorage.getItem("token"),n={username:a.username,userId:a.userId,avatarUrl:a.avatarUrl,isConfirmation:a.isConfirmation},i({type:"USER_LOGIN",payload:n}),p(!1),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(0),console.log(e.t0);case 17:case"end":return e.stop()}}),e,null,[[0,14]])})));return function(){return e.apply(this,arguments)}})()()}),[]),m?o.a.createElement("div",null,"Loading..."):o.a.createElement(Q.Provider,{value:{userInfo:c,dispatch:i}},t)},ee=Object(g.a)((function(e){return{DashBoard:{marginTop:"20px",width:"80%",margin:"0 auto",padding:e.spacing(3,2),paddingBottom:"50px",position:"relative"},username:{position:"absolute",top:"10px",right:"20px",fontSize:"20px"},flex:{display:"flex",padding:"10px",alignItems:"center"},roomWindow:{width:"30%",height:"450px"},roomDetails:{display:"flex",justifyContent:"Space-Between",alignItems:"center"},chatWindow:{width:"70%",boxShadow:"-5px 0 10px rgba(0, 0, 0, 0.2)"},messageWindow:{height:"400px",marginBottom:"10px"},chatBox:{marginLeft:"20px",flexGrow:1},button:{marginTop:"15px",marginLeft:"10px",height:"30px",width:"100px",backgroundColor:"#1976d2","&:hover":{backgroundColor:"#115293"}},chip:{marginRight:"5px",float:"right"},friendAccount:{display:"flex",padding:"10px",alignItems:"center"},myAccount:{display:"flex",padding:"10px",alignItems:"center",justifyContent:"flex-end"},flexSpaceBetween:{display:"flex",justifyContent:"SpaceBetween"}}}));var te=function(e){var t=ee(),a=Object(r.useContext)(S),n=a.allChats,c=a.sendChatAction,i=Object(r.useContext)(Q).userInfo,g=Object.keys(n),v=Object(r.useState)(g[0]),h=Object(s.a)(v,2),E=h[0],x=h[1],O=Object(r.useState)(""),y=Object(s.a)(O,2),j=y[0],w=y[1],k=localStorage.getItem("token");return console.log(i.userId),o.a.createElement(l.a,{className:t.DashBoard,elevation:3},o.a.createElement(u.a,{variant:"h3",component:"h3"},"Chat app"),o.a.createElement(u.a,{className:t.username,variant:"p",component:"p"},o.a.createElement($,null,i.username)),o.a.createElement("div",{className:t.roomDetails},"Room Id: ",E,o.a.createElement("div",{className:t.flex},o.a.createElement(U,null),o.a.createElement(P,null))),o.a.createElement("div",{className:t.flex},o.a.createElement(K.a,{mode:"top",className:t.roomWindow},o.a.createElement(m.a,null,g.map((function(e,t){return o.a.createElement(M,{key:t,roomId:e,primary:n[e].name,currentRoom:E,onClick:function(){x(e)}})})))),o.a.createElement("div",{className:t.chatWindow},o.a.createElement(K.a,{className:t.messageWindow},n[E]&&n[E].messages.map((function(e,a){return o.a.createElement("div",{className:i.userId===e.user._id?t.myAccount:t.friendAccount,key:a},o.a.createElement(p.a,{avatar:o.a.createElement(d.a,{alt:"avatar",src:e.user.avatarUrl?e.user.avatarUrl:"/avatarDefault.png"}),label:e.user.name,className:t.chip}),o.a.createElement(u.a,null,e.content))}))),o.a.createElement("form",{onSubmit:function(e){e.preventDefault(),j.trim()&&(c({token:k,msg:j.trim(),roomId:E}),w(""))}},o.a.createElement("div",{className:t.flex},o.a.createElement(b.a,{className:t.chatBox,label:"Send a message",value:j,onChange:function(e){return w(e.target.value)}}),o.a.createElement(f.a,{type:"submit",variant:"contained",color:"primary",className:t.button,size:"small"},"Send"))))))};function ae(){return o.a.createElement("div",null,"Please check your email to confirm your account")}var ne=a(37),re=a(12),oe=Object(g.a)((function(e){return{LoginPage:{marginTop:"100px",width:"550px",margin:"0 auto",padding:e.spacing(3,2),paddingBottom:"50px"},disableButton:{opacity:.5,width:"80%",padding:"10px",marginTop:"20px",backgroundColor:"#1976d2"},alert:{width:"80%",margin:"0 auto"},input:{width:"80%",marginBottom:"20px"},button:{width:"80%",padding:"10px",marginTop:"20px",backgroundColor:"#1976d2","&:hover":{backgroundColor:"#115293"}},register:{marginTop:"30px","& a":{color:"#1976d2",textDecoration:"none"}}}}));var ce=function(e){var t=oe(),a=Object(r.useState)(""),n=Object(s.a)(a,2),c=n[0],i=n[1],m=Object(r.useState)(""),p=Object(s.a)(m,2),d=p[0],g=p[1],v=Object(r.useState)(!1),O=Object(s.a)(v,2),j=O[0],w=O[1],k=Object(r.useState)(""),C=Object(s.a)(k,2),N=C[0],S=C[1],I=Object(r.useContext)(Q).dispatch,R=function(){var e=Object(E.a)(h.a.mark((function e(t){var a,n,r;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),c){e.next=4;break}return S("Please type your email"),e.abrupt("return");case 4:if(d){e.next=7;break}return S("Please type your password"),e.abrupt("return");case 7:return w(!0),e.prev=8,e.next=11,y.a.post("/auth/doLogin",{email:c,password:d});case 11:if(a=e.sent,(n=a.data).success){e.next=17;break}return S(n.msg),w(!1),e.abrupt("return");case 17:y.a.defaults.headers.common["x-access-token"]=n.token,localStorage.setItem("token",n.token),r={username:n.username,userId:n.userId,avatarUrl:n.avatarUrl,isConfirmation:n.isConfirmation},I({type:"USER_LOGIN",payload:r}),e.next=26;break;case 23:e.prev=23,e.t0=e.catch(8),console.log(e.t0);case 26:case"end":return e.stop()}}),e,null,[[8,23]])})));return function(t){return e.apply(this,arguments)}}();return o.a.createElement(l.a,{className:t.LoginPage,elevation:3},o.a.createElement(u.a,{variant:"h3",component:"h3"},"Login"),o.a.createElement("form",{className:t.form,onSubmit:R},N&&o.a.createElement(x.a,{className:t.alert,severity:"error"},N),o.a.createElement(b.a,{className:t.input,label:"Email",variant:"filled",onChange:function(e){i(e.target.value)}}),o.a.createElement(b.a,{className:t.input,label:"Password",type:"password",variant:"filled",onChange:function(e){g(e.target.value)}}),o.a.createElement(f.a,{type:"submit",className:j?t.disableButton:t.button,variant:"contained",color:"primary",disable:j},"Login")),o.a.createElement("div",{className:t.register},"Don't have any account? ",o.a.createElement(ne.b,{to:"/register"},"Register")))},ie=Object(g.a)((function(e){return{registerPage:{marginTop:"100px",width:"550px",margin:"0 auto",padding:e.spacing(3,2),paddingBottom:"50px"},disableButton:{opacity:.5,width:"80%",padding:"10px",marginTop:"20px",backgroundColor:"#1976d2"},alert:{width:"80%",margin:"0 auto"},input:{width:"80%",marginBottom:"20px"},button:{width:"80%",padding:"10px",marginTop:"20px",backgroundColor:"#1976d2","&:hover":{backgroundColor:"#115293"}},register:{marginTop:"30px","& a":{color:"#1976d2",textDecoration:"none"}}}}));var se=function(e){var t=Object(re.e)(),a=ie(),n=Object(r.useState)(""),c=Object(s.a)(n,2),i=c[0],m=c[1],p=Object(r.useState)(""),d=Object(s.a)(p,2),g=d[0],v=d[1],O=Object(r.useState)(""),j=Object(s.a)(O,2),w=j[0],k=j[1],C=Object(r.useState)(""),N=Object(s.a)(C,2),S=N[0],I=N[1],R=Object(r.useState)(!1),B=Object(s.a)(R,2),L=B[0],_=B[1],P=Object(r.useState)(""),T=Object(s.a)(P,2),U=T[0],D=T[1],A=Object(r.useContext)(Q).dispatch,F=function(){var e=Object(E.a)(h.a.mark((function e(a){var n,r,o;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a.preventDefault(),S){e.next=4;break}return D("Please type your name"),e.abrupt("return");case 4:if(i){e.next=7;break}return D("Please type your email"),e.abrupt("return");case 7:if(g){e.next=10;break}return D("Please type your password"),e.abrupt("return");case 10:if(w){e.next=13;break}return D("Please confirm your password"),e.abrupt("return");case 13:if(w===g){e.next=16;break}return D("Password is not match"),e.abrupt("return");case 16:return _(!0),e.prev=17,e.next=20,y.a.post("/register",{email:i,password:g,name:S});case 20:if(n=e.sent,(r=n.data).success){e.next=26;break}return D(r.msg),_(!1),e.abrupt("return");case 26:y.a.defaults.headers.common["x-access-token"]=r.token,localStorage.setItem("token",r.token),o={username:r.username,userId:r.userId,avatarUrl:r.avatarUrl,isConfirmation:r.isConfirmation},A({type:"USER_LOGIN",payload:o}),t.push("/"),e.next=36;break;case 33:e.prev=33,e.t0=e.catch(17),console.log(e.t0);case 36:case"end":return e.stop()}}),e,null,[[17,33]])})));return function(t){return e.apply(this,arguments)}}();return o.a.createElement(l.a,{className:a.registerPage,elevation:3},o.a.createElement(u.a,{variant:"h3",component:"h3"},"Register"),o.a.createElement("form",{className:a.form,onSubmit:F},U&&o.a.createElement(x.a,{className:a.alert,severity:"error"},U),o.a.createElement(b.a,{className:a.input,label:"Name",variant:"filled",onChange:function(e){I(e.target.value)}}),o.a.createElement(b.a,{className:a.input,label:"Email",variant:"filled",onChange:function(e){m(e.target.value)}}),o.a.createElement(b.a,{className:a.input,label:"Password",type:"password",variant:"filled",onChange:function(e){v(e.target.value)}}),o.a.createElement(b.a,{className:a.input,label:"Confirm ",type:"password",variant:"filled",onChange:function(e){k(e.target.value)}}),o.a.createElement(f.a,{type:"submit",className:L?a.disableButton:a.button,variant:"contained",color:"primary",disable:L},"Register")),o.a.createElement("div",{className:a.register},"Have an account? ",o.a.createElement(ne.b,{to:"/"},"Login")))};var le=function(){var e=Object(r.useContext)(Q).userInfo;return console.log("app"),o.a.createElement(ne.a,null,e.isLoggedIn?o.a.createElement(L,null,o.a.createElement("div",{className:"App"},o.a.createElement(re.a,{exact:!0,path:"/"},e.isConfirmation?o.a.createElement(te,null):o.a.createElement(ae,null)))):o.a.createElement("div",{className:"App"},o.a.createElement(re.a,{exact:!0,path:"/"},o.a.createElement(ce,null)),o.a.createElement(re.a,{exact:!0,path:"/register"},o.a.createElement(se,null))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(o.a.createElement(o.a.StrictMode,null,o.a.createElement(Z,null,o.a.createElement(le,null))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[129,1,2]]]);
//# sourceMappingURL=main.9c305329.chunk.js.map